#############################################
########### Run RCP plug-in tests ###########
#############################################

RCP plug-in tests:
  image: maven:3.5.4-jdk-8
  stage: gui-test
  needs: []
  script:
    - echo "==================== [RCP tests] Run coverage tests ===================="
    - mkdir coverage
    - cd rcp/src/io.arg.webgui
    - echo "==================== [RCP tests] Run plug-in tests ===================="
    - mvn clean install
    - cp -R tests/io.arg.webgui.plugin.tests/target/coverage-site/. ../../../coverage/
  artifacts:
    expire_in: 3 days
    paths:
      - coverage
    reports:
      junit: rcp/src/io.arg.webgui/tests/io.arg.webgui.plugin.tests/target/surefire-reports/TEST-*.xml
      cobertura: rcp/src/io.arg.webgui/tests/io.arg.webgui.plugin.tests/target/coverage-site/jacoco.xml
  rules:
#   Always run when pushing a release candidate
    - if: $CI_COMMIT_REF_NAME =~ /^\d{1,}\.\d{1,}\.\d{1,}-RC\d{1,}/
    - if: '$CI_COMMIT_REF_PROTECTED == "true"'
    - if: '$CI_COMMIT_REF_PROTECTED == "" || $CI_COMMIT_REF_PROTECTED == "false"'
      changes:
      - rcp/**/*
      - web/**/*